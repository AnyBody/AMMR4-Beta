#define MotionAndParameterOptimizationModel 1
#define InverseDynamicModel 0
#define HumanModelPresent  0
#define SetIntialPosition 
//This is a list of the classes used for defining the model
//Class used for defining a marker
#include "../../../Body/AAUHuman/ToolBox/Mocap/CreateMarkerClass.any"
//Class used for defining a marker
#include "../../../Body/AAUHuman/ToolBox/Mocap/CreateMarkerClassTD.any"
//Class used to construct a forceplate of type4
#include "../../../Body/AAUHuman/ToolBox/Mocap/ForcePlateType4AutoDetection.any"
#include "../../../Body/AAUHuman/ToolBox/Mocap/ForcePlateType4.any"

//Class used for defining a which antrhopometics measurements will be part of the analysis
#include "../../../Body/AAUHuman/ToolBox/Mocap/OptimizeAnthropometricsOnOff.any"



Main ={
  
  
  #include "GaitLowerExtremityProject.Main.any"

  #include "ModelSetup.any" 
  #include "TrialSpecificData.any" 
  
  
  Main.Project.Files.MainFile="InitialPos.Main.any";
  
  
  
  Main.Project={
    
    Files = {
      SetValueFile = Main.TrialSpecificData.NameOfFile+"-MarkerPositionWidgetValues.txt";
    };
    
    
    
    Tasks.Set_Initial_Position  = {
      
      Description = {
        Title = "<h4>Set Initial Position</h4>";
        
        BodyText = 
        "This task can be used to do the following two initial adjustments of the model<br/>" +
        strformat ("\t")+"1.) Set the initial scaling of human model <br/>"+
        strformat ("\t")+"2.) Set the initial joint angles and pelvis position<br/>"+
        
        "<h4> 1.) Set the initial scaling of human model</h4>"+
        "The initial size of the human body can be set "+  AnyScriptLinkOf(&Main.TrialSpecificData.Anthropometrics,"here")+
        "<br/>" +
        "Please note that these values (except mass) may be changed if the motion is being optimized later, in that case these values are only used " +
        "as the initial guess." +
        "<br/>" +
        "<h4> 2.) Set the initial joint angles and pelvis position </h4>"+
        "The initial position and orientation of pelvis can be set "+  AnyScriptLinkOf(&Main.TrialSpecificData.InitialPositionOfBody,"here") + 
        " additionally the joint angles can be adjusted. More detailed positioning can be done directly in the mannequin file "+
        AnyScriptLinkOf(&Main.InitialPosStudy.Mannequin,"mannequin file")+
        "<br/>" +
        " <h4> Execute Task Description</h4>"+
        "Executing the task will drive the position of pelvis and the joint angles into the specified positions. This task can be used to finetune the initial position "+ 
        "to macth the recorded marker positions." +
        "This is needed for the subsequent analysis of parameter and motion optimization";
        
        Tooltip = "Adjust the initial position";
      };
      
      Operation =  &Main.InitialPosStudy.Kinematics;
      
    };
  };  
  HumanModel={
    AnyFolder &Mannequin=.InitialPosStudy.Mannequin;
    #include  "BodyPartsSetupKin.any"
  };
  
  #include "HumanModel.any"
  
  
  AnyBodyStudy InitialPosStudy = {
    
    AnyFolder &HumanModel=.HumanModel.BodyModel;
    
    
    AnyFolder &C3DData=.ModelSetup.C3DFileData ;
    
    
    //This mannequin calculates a guess on the initial pelvis position based on ASIS and PSI markers
    //if these markers do not exist in the markerset used this has to be changed
    #include "Mannequin.any"  // this file controls the initial position of the model and he posture
    Gravity = .TrialSpecificData.Gravity;
    tStart = Main.TrialSpecificData.tStart+2*Kinematics.ApproxVelAccPerturb; 
    tEnd = Main.TrialSpecificData.tEnd-2*Kinematics.ApproxVelAccPerturb;
    
    nStep=1;
    
    AnyFolder ModelEnvironmentConnection = {
      AnyFolder &HumanModel=.HumanModel;
      #include "JointsAndDrivers.any"
      
      
    };
    //Environment around the human
    AnyFolder EnvironmentModel ={
      
      //    AnyFixedRefFrame GlobalRef ={       AnyDrawRefFrame drw={ScaleXYZ=0.4*{1,1,1};};    };  
      //Model of the floor and force plates this is where the force plates are defined        
      AnyFolder &HumanModelRef=..HumanModel.BodyModel;        
      //This environment file makes use of automatic detection of which foot are incontact with which plate 
      #include "EnvironmentAutoDetection.any"
      //This environment file has no automatic detecteion of which foot are incontact with which plate it has to be set manually
      //#include "Environment.any"
    };
    
    
  };   
};
#undef InverseDynamicModel
#undef MotionAndParameterOptimizationModel
#undef HumanModelPresent
#undef SetIntialPosition 

